!function(e,t,i,o){function n(t,i){this.element=t,this.options=e.extend({},r,i),this._defaults=r,this._name=s,this._ignoreHashChange=!1,this.init()}var s="curtain",r={scrollSpeed:400,bodyHeight:0,linksArray:[],mobile:!1,scrollButtons:{},controls:null,curtainLinks:".curtain-link",enableKeys:!0,easing:"swing",disabled:!1,nextSlide:function(){},prevSlide:function(){}};n.prototype={init:function(){var o=this;this.$element=e(this.element),this.$li=e(this.element).find(".cover"),this.$liLength=this.$li.length,o.$windowHeight=e(t).height(),o.$elDatas={},o.$document=e(i),o.$window=e(t),o.webkit=navigator.userAgent.indexOf("Chrome")>-1||navigator.userAgent.indexOf("Safari")>-1,e.Android=navigator.userAgent.match(/Android/i),e.iPhone=navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPod/i),e.iPad=navigator.userAgent.match(/iPad/i),e.iOs4=/OS [1-4]_[0-9_]+ like Mac OS X/i.test(navigator.userAgent),(e.iPhone||e.iPad||e.Android||o.options.disabled)&&(this.options.mobile=!0,this.$li.css({position:"relative"}),this.$element.find(".fixed").css({position:"absolute"})),this.options.mobile&&(this.scrollEl=this.$element),this.scrollEl="webkitRequestAnimationFrame"in t?e("html, body"):e("html, body"),o.options.controls&&(o.options.scrollButtons.up=e(o.options.controls).find('[href="#up"]'),o.options.scrollButtons.down=e(o.options.controls).find('[href="#down"]'),e.iOs4||!e.iPhone&&!e.iPad||(this.scrollEl=o.$element,o.$element.css({position:"fixed",top:0,left:0,right:0,bottom:0,"-webkit-overflow-scrolling":"touch",overflow:"auto"}),e(o.options.controls).css({position:"absolute"})));var n=function(){o.setDimensions(),o.$li.eq(0).addClass("current"),o.setCache(),o.options.mobile||o.$li.eq(1).length&&o.$li.eq(1).nextAll().addClass("hidden"),o.setEvents(),o.setLinks(),o.isHashIsOnList(location.hash.substring(1))};o.$element.find("img").length?o.imageLoaded(n):n()},scrollToPosition:function(t){var i=null,n=this;if(n.scrollEl.is(":animated"))return!1;if("up"===t||"down"==t){var s="up"===t?n.$current.prev():n.$current.next();if(n.$step){n.$current.find(".current-step").length||n.$step.eq(0).addClass("current-step");var r="up"===t?n.$current.find(".current-step").prev(".step"):n.$current.find(".current-step").next(".step");r.length&&(i=n.options.mobile?r.position().top+n.$elDatas[n.$current.index()]["data-position"]:r.position().top+n.$elDatas[n.$current.index()]["data-position"])}i=i||(n.$elDatas[s.index()]===o?null:n.$elDatas[s.index()]["data-position"]),null!==i&&n.scrollEl.animate({scrollTop:i},n.options.scrollSpeed,n.options.easing)}else if("top"===t)n.scrollEl.animate({scrollTop:0},n.options.scrollSpeed,n.options.easing);else if("bottom"===t)n.scrollEl.animate({scrollTop:n.options.bodyHeight},n.options.scrollSpeed,n.options.easing);else{var a=e("#"+t).index(),l=Math.abs(n.currentIndex-a)*4*this.options.scrollSpeed/n.$liLength;n.scrollEl.animate({scrollTop:n.$elDatas[a]["data-position"]||null},l<=n.options.scrollSpeed?n.options.scrollSpeed:l,this.options.easing)}},scrollEvent:function(){var t=this,i=t.$document.scrollTop();i<t.currentP&&t.currentIndex>0?(t._ignoreHashChange=!0,t.$current.prev().attr("id")&&t.setHash(t.$current.prev().attr("id")),t.$current.removeClass("current").css(t.webkit?{"-webkit-transform":"translateY(0px) translateZ(0)"}:{marginTop:0}).nextAll().addClass("hidden").end().prev().addClass("current").removeClass("hidden"),t.setCache(),t.options.prevSlide()):i<t.currentP+t.currentHeight?(t.webkit?t.$current.css({"-webkit-transform":"translateY("+-(i-t.currentP)+"px) translateZ(0)"}):t.$current.css({marginTop:-(i-t.currentP)}),t.$fixedLength&&(parseInt(t.$fixed.attr("data-top"),10),i+t.$windowHeight>=t.currentP+t.currentHeight?t.$fixed.css({position:"fixed"}):t.$fixed.css({position:"absolute",marginTop:Math.abs(i-t.currentP)})),t.$stepLength&&e.each(t.$step,function(o,n){return e(n).position().top+t.currentP<=i+5&&e(n).position().top+t.currentP+e(n).height()>=i+5&&!e(n).hasClass("current-step")?(t.$step.removeClass("current-step"),e(n).addClass("current-step"),!1):void 0}),t.parallaxBg&&t.$current.css({"background-position-y":i*t.parallaxBg}),t.$fade.length&&t.$fade.css({opacity:1-i/t.$fade.attr("data-fade")}),t.$slowScroll.length&&t.$slowScroll.css({"margin-top":i/t.$slowScroll.attr("data-slow-scroll")})):(t._ignoreHashChange=!0,t.$current.next().attr("id")&&t.setHash(t.$current.next().attr("id")),t.$current.removeClass("current").addClass("hidden").next(".cover").addClass("current").next(".cover").removeClass("hidden"),t.setCache(),t.options.nextSlide())},scrollMobileEvent:function(){var t=this,i=t.$element.scrollTop();i+10<t.currentP&&t.currentIndex>0?(t._ignoreHashChange=!0,t.$current.prev().attr("id")&&t.setHash(t.$current.prev().attr("id")),t.$current.removeClass("current").prev().addClass("current"),t.setCache(),t.options.prevSlide()):i+10<t.currentP+t.currentHeight?t.$stepLength&&e.each(t.$step,function(o,n){e(n).position().top+t.currentP<=i&&e(n).position().top+t.currentP+e(n).outerHeight()>=i&&(e(n).hasClass("current-step")||(t.$step.removeClass("current-step"),e(n).addClass("current-step")))}):(t._ignoreHashChange=!0,t.$current.next().attr("id")&&t.setHash(t.$current.next().attr("id")),t.$current.removeClass("current").next().addClass("current"),t.setCache(),t.options.nextSlide())},setDimensions:function(){var t=this,i=0,o=!1,n=null;t.$windowHeight=t.$window.height(),this.$li.each(function(s){var r=e(this);if(o=r.hasClass("front-cover"),o?(r.css({height:t.$windowHeight,zIndex:999-s}).attr("data-height",t.$windowHeight).attr("data-position",i),t.$elDatas[r.index()]={"data-height":parseInt(t.$windowHeight,10),"data-position":parseInt(i,10)},i+=t.$windowHeight):(n=r.outerHeight()<=t.$windowHeight?t.$windowHeight:r.outerHeight(),r.css({height:n,zIndex:999-s}).attr("data-height",n).attr("data-position",i),t.$elDatas[r.index()]={"data-height":parseInt(n,10),"data-position":parseInt(i,10)},i+=n),r.find(".fixed").length){var a=r.find(".fixed").css("top");r.find(".fixed").attr("data-top",a)}}),this.options.mobile||this.setBodyHeight()},setEvents:function(){var i=this;e(t).on("resize",function(){i.setDimensions()}),i.options.mobile?i.$element.on("scroll",function(){i.scrollMobileEvent()}):i.$window.on("scroll",function(){i.scrollEvent()}),i.options.enableKeys&&i.$document.on("keydown",function(e){return 38===e.keyCode||37===e.keyCode?(i.scrollToPosition("up"),e.preventDefault(),!1):40===e.keyCode||39===e.keyCode?(i.scrollToPosition("down"),e.preventDefault(),!1):36===e.keyCode?(i.scrollToPosition("top"),e.preventDefault(),!1):35===e.keyCode?(i.scrollToPosition("bottom"),e.preventDefault(),!1):void 0}),i.options.scrollButtons&&(i.options.scrollButtons.up&&i.options.scrollButtons.up.on("click",function(e){e.preventDefault(),i.scrollToPosition("up")}),i.options.scrollButtons.down&&i.options.scrollButtons.down.on("click",function(e){e.preventDefault(),i.scrollToPosition("down")})),i.options.curtainLinks&&e(i.options.curtainLinks).on("click",function(t){t.preventDefault();var o=e(this).attr("href");if(!i.isHashIsOnList(o.substring(1))&&n)return!1;var n=i.$elDatas[e(o).index()]["data-position"]||null;return n&&i.scrollEl.animate({scrollTop:n},i.options.scrollSpeed,i.options.easing),!1}),i.$window.on("hashchange",function(){i._ignoreHashChange===!1&&i.isHashIsOnList(location.hash.substring(1)),i._ignoreHashChange=!1})},setBodyHeight:function(){var t=0;for(var i in this.$elDatas){var o=this.$elDatas[i];t+=o["data-height"]}this.options.bodyHeight=t,e("body").height(t)},setLinks:function(){var t=this;this.$li.each(function(){var i=e(this).attr("id")||0;t.options.linksArray.push(i)})},setHash:function(t){el=e("[href=#"+t+"]"),el.parent().siblings(".cover").removeClass("active"),el.parent().addClass("active"),history.pushState?history.pushState(null,null,"#"+t):location.hash=t},setCache:function(){var e=this;e.$current=e.$element.find(".current"),e.$fixed=e.$current.find(".fixed"),e.$fixedLength=e.$fixed.length,e.$step=e.$current.find(".step"),e.$stepLength=e.$step.length,e.currentIndex=e.$current.index(),e.currentP=e.$elDatas[e.currentIndex]["data-position"],e.currentHeight=e.$elDatas[e.currentIndex]["data-height"],e.parallaxBg=e.$current.attr("data-parallax-background"),e.$fade=e.$current.find("[data-fade]"),e.$slowScroll=e.$current.find("[data-slow-scroll]")},isHashIsOnList:function(t){var i=this;e.each(i.options.linksArray,function(e,o){return o===t?(i.scrollToPosition(t),!1):void 0})},readyElement:function(e,t){var i=setInterval(function(){e.length&&(t(e.length),clearInterval(i))},60)},imageLoaded:function(t){var i=this,n=i.$element.find("img"),s=n.length,r="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==";n.bind("load.imgloaded",function(){(--s<=0&&this.src!==r||e(this).not(":visible"))&&(n.unbind("load.imgloaded"),t.call(n,this))}).each(function(){if(this.complete||this.complete===o){var e=this.src;this.src=r,this.src=e}})}},e.fn[s]=function(t){return this.each(function(){e.data(this,"plugin_"+s)||e.data(this,"plugin_"+s,new n(this,t))})}}(jQuery,window,document);